const { RTMClient, LogLevel } = require('./dist/index');

const rtm = new RTMClient('xoxb-258025193585-XpDalMv6UUaV7Es0tbG0UGtb', { logLevel: LogLevel.DEBUG });

rtm.start();

function wait(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// echo
rtm.on('message', (event) => {
  rtm.sendTyping(event.channel)
    .then(() => wait(2000))
    .then(() => rtm.sendMessage(event.text, event.channel))
    .then((reply) => {
      console.log(`Reply ts: ${reply.ts}`);
    })
    .catch(console.error);
});

rtm.sendMessage('startup', 'D7LHJ36H2')
  .then(() => console.log('startup message sent'))
  .catch(console.error);

// will messages sent in a disconnected state get sent later after reconnection?
// setTimeout(() => {
//   console.log('disconnecting...');
//   rtm.disconnect();

//   rtm.sendMessage('resume', 'D7LHJ36H2', (error, ack) => {
//     console.log('resume message sent');
//     rtm.disconnect();
//   });

//   setTimeout(() => {
//     rtm.start();
//   }, 3000);
// }, 10000);

// disconnected before reply recieved
wait(10000)
  .then(() => {
    rtm.sendMessage('after 10 secs', 'D7LHJ36H2')
      .then(console.log)
      .catch(console.error);
    rtm.disconnect();
  });


